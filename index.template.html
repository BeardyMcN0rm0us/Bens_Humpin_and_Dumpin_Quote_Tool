<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ben’s Humpin’ & Dumpin’ Quick Quote Tool</title>
<style>
  :root { --bg:#000; --fg:#fff; --muted:#bbb; --panel:#111; --accent:#ff4500; --border:#333; }
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:var(--bg); color:var(--fg); }
  .container { max-width: 640px; margin: 0 auto; padding: 20px; }
  h1 { color:var(--accent); text-align:center; margin: 0 0 12px; }
  label { display:block; margin-top:10px; }
  input, select, textarea, button {
    width:100%; padding:10px; margin-top:6px; border-radius:10px; border:1px solid var(--border);
    background:var(--panel); color:var(--fg);
  }
  textarea { min-height: 90px; resize: vertical; }
  button { background:var(--accent); font-weight:700; cursor:pointer; border:none; }
  .hidden { display:none; }
  .row { display:flex; gap:12px; flex-wrap:wrap; }
  .breakdown { margin-top:18px; font-size:0.95rem; line-height:1.35; }
  .total { font-size:1.25rem; font-weight:800; margin-top:10px; }
  .sm { font-size:.85rem; color:var(--muted); }
  .disclaimer { margin-top:14px; padding:10px; background:#1b1b1b; border-left:4px solid var(--accent); color:#ccc; font-size:.9rem; }
  #photoPreview { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
  #photoPreview img { width: 96px; height: 96px; object-fit: cover; border-radius: 10px; border:1px solid var(--border); }
  .photo-bar { display:flex; align-items:center; gap:10px; margin-top:8px; }
  .icon-btn { display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:12px; border-radius:12px; background:#1a1a1a; color:#fff; border:1px solid var(--border); width:auto; }
  .icon-btn svg { width:22px; height:22px; }
  .cta-row { display:flex; gap:12px; }
  @media (max-width:520px){ .cta-row { flex-direction:column; } }
</style>
</head>
<body>
<div class="container">
  <h1>Ben’s Quick Quote Tool</h1>

  <label for="jobType">Job Type</label>
  <select id="jobType">
    <option value="" selected disabled>Select a service…</option>
    <option value="tip">1️⃣ Tip Run</option>
    <option value="move">2️⃣ House Move</option>
    <option value="marketplace">3️⃣ Facebook Marketplace Pickup/Drop-off</option>
    <option value="shop">4️⃣ Emergency Shop Run</option>
    <option value="student">5️⃣ Student Relocation (to/from uni)</option>
    <option value="business">6️⃣ Business Enquiries / Barter Deals</option>
    <option value="other">7️⃣ Other (Tell me what you need)</option>
  </select>

  <div id="pickupField">
    <label for="addrPickup">Collection Address</label>
    <input type="text" id="addrPickup" placeholder="Enter collection address" autocomplete="street-address">
  </div>

  <div id="addrDropWrap">
    <label for="addrDrop">Delivery Address</label>
    <input type="text" id="addrDrop" placeholder="Enter delivery address" autocomplete="street-address">
  </div>

  <!-- Mileage hidden but used -->
  <input type="number" id="mileage" class="hidden" readonly>

  <div id="twoManWrap">
    <label for="twoMan">Two-person job?</label>
    <select id="twoMan">
      <option value="no">No</option>
      <option value="yes">Yes</option>
    </select>
  </div>

  <div id="stairsWrap">
    <label for="stairsPickup">Stairs at Pickup (floors)</label>
    <input type="number" id="stairsPickup" value="0" min="0">
    <label for="stairsDrop">Stairs at Drop-off (floors)</label>
    <input type="number" id="stairsDrop" value="0" min="0">
  </div>

  <div id="wasteWrap">
    <label for="wasteType">Waste Type (Tip Runs)</label>
    <select id="wasteType">
      <option value="mixed">Mixed Waste</option>
      <option value="inert">Inert Waste</option>
      <option value="wood">Wood</option>
      <option value="green">Green Waste</option>
      <option value="plaster">Plasterboard</option>
      <option value="mattress">Mattress</option>
      <option value="tyre">Tyre</option>
    </select>

    <div id="qtyWrap" class="hidden">
      <label for="itemQty">Quantity (items)</label>
      <input type="number" id="itemQty" value="1" min="1" step="1">
    </div>
    <div class="sm">We’ll use the minimum disposal fee. If it’s more, Ben will confirm from your photos.</div>
  </div>

  <div id="descWrap" class="hidden">
    <label for="jobDesc">What is it? (Describe the job)</label>
    <textarea id="jobDesc" placeholder="e.g., swap a sofa for a table; collect a treadmill; etc."></textarea>
  </div>

  <button id="btnCalc" class="hidden" <button id="btnCalc" type="button">Calculate Quote</button>

  <div id="routeHint" class="hidden" Enter your address(es) above, then tap “Calculate Quote”.</div>
  <div id="breakdown" class="breakdown"></div>
  <div id="total" class="total"></div>

  <div class="disclaimer">
    ⚠️ This is an <strong>estimated quote</strong>. Final price depends on access, load, and photos. Ben will confirm before booking.
  </div>

  <!-- Photos at the bottom -->
  <div id="photosWrap" style="margin-top:20px;">
    <label for="photos" class="sm">Add photos (camera or gallery)</label>

    <input id="photos" class="hidden" type="file" accept="image/*" multiple>

    <div class="photo-bar">
      <button id="btnCamera" type="button" class="icon-btn" aria-controls="photos">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M9 7l1.5-2h3L15 7h3a3 3 0 013 3v7a3 3 0 01-3 3H6a3 3 0 01-3-3v-7a3-3 0 013-3h3z" stroke="currentColor" stroke-width="1.6"/>
          <circle cx="12" cy="14" r="3.5" stroke="currentColor" stroke-width="1.6"/>
        </svg>
        <span>Add photos</span>
      </button>
      <span id="photoCount" class="sm">No photos selected</span>
    </div>

    <div id="photoPreview"></div>
  </div>

  <div class="cta-row" style="margin-top:14px">
    <button id="btnWhatsApp" type="button">Send to WhatsApp</button>
  </div>
</div>

<script>
const HOME_ADDR = "15 Primrose Hill, Doddington, Cambs, PE15 0SU";
const WATERBEACH_ADDR = "Waterbeach Waste Management Park, Ely Road, Waterbeach, Cambridge CB25 9PG";

const RATES = {
  baseFee: 35, mileagePerMile: 0.40, twoMan: 20, stairsPerFloor: 5,
  disposal: {
    mixed:{ ratePerTonne: 150, minFee: 40 },
    inert:{ ratePerTonne: 25,  minFee: 20 },
    wood:{  ratePerTonne: 75,  minFee: 20 },
    green:{ ratePerTonne: 30,  minFee: 20 },
    plaster:{ratePerTonne: 130, minFee: 40 },
    mattress:{ each: 20 }, tyre:{ each: 6 }
  }
};

const BUSINESS_WHATSAPP = "447717463496";

const els = {
  
  pickupField: document.getElementById('pickupField'),
jobType: document.getElementById('jobType'),
  mileage: document.getElementById('mileage'),
  twoMan: document.getElementById('twoMan'),
  twoManWrap: document.getElementById('twoManWrap'),
  stairsPickup: document.getElementById('stairsPickup'),
  stairsDrop: document.getElementById('stairsDrop'),
  stairsWrap: document.getElementById('stairsWrap'),
  wasteType: document.getElementById('wasteType'),
  wasteWrap: document.getElementById('wasteWrap'),
  qtyWrap: document.getElementById('qtyWrap'),
  itemQty: document.getElementById('itemQty'),
  breakdown: document.getElementById('breakdown'),
  total: document.getElementById('total'),
  addrPickup: document.getElementById('addrPickup'),
  addrDrop: document.getElementById('addrDrop'),
  addrDropWrap: document.getElementById('addrDropWrap'),
  routeHint: document.getElementById('routeHint'),
  btnCalc: document.getElementById('btnCalc'),
  btnWA: document.getElementById('btnWhatsApp'),
  jobDesc: document.getElementById('jobDesc'),
  descWrap: document.getElementById('descWrap'),
  photos: document.getElementById('photos'),
  btnCamera: document.getElementById('btnCamera'),
  photoPreview: document.getElementById('photoPreview'),
  photoCount: document.getElementById('photoCount')
};


els.jobType.addEventListener(\'change\', setJobTypeUI);
document.addEventListener(\'DOMContentLoaded\', setJobTypeUI);
let pickupAddress = "", dropAddress = "";
let directions, placesPickup, placesDrop;

function setJobTypeUI(){
  const jt = els.jobType.value;

  // Hide everything by default
  [els.addrDropWrap, els.wasteWrap, els.twoManWrap, els.stairsWrap, els.descWrap, els.photosWrap, els.btnCalc, els.routeHint]
    .forEach(el => el.classList.add('hidden'));

  // No selection yet
  if(!jt){ return; }

  // Always show pickup field once a service is chosen
  els.pickupField.classList.remove('hidden');
  els.photosWrap.classList.remove('hidden');
  els.btnCalc.classList.remove('hidden');
  els.routeHint.classList.remove('hidden');

  if (jt === "tip"){
    // Tip Run: Home → Collection → Waterbeach → Home
    els.addrDropWrap.classList.add('hidden');
    els.wasteWrap.classList.remove('hidden');
    els.twoManWrap.classList.add('hidden');
    els.stairsWrap.classList.add('hidden');
    els.descWrap.classList.add('hidden');
    els.routeHint.textContent = "Route: Home → Collection → Waterbeach → Home";
  } else if (jt === "move" || jt === "student"){
    // Moves/Student: full service
    els.addrDropWrap.classList.remove('hidden');
    els.wasteWrap.classList.add('hidden');
    els.twoManWrap.classList.remove('hidden');
    els.stairsWrap.classList.remove('hidden');
    els.descWrap.classList.add('hidden');
    els.routeHint.textContent = "Route: Home → Pickup → Drop-off → Home";
  } else if (jt === "marketplace"){
    // Marketplace: addresses needed, keep it simple
    els.addrDropWrap.classList.remove('hidden');
    els.wasteWrap.classList.add('hidden');
    els.twoManWrap.classList.remove('hidden');
    els.stairsWrap.classList.remove('hidden');
    els.descWrap.classList.add('hidden');
    els.routeHint.textContent = "Route: Home → Pickup → Drop-off → Home";
  } else if (jt === "shop"){
    // Emergency Shop Run: addresses only, no stairs/two-man
    els.addrDropWrap.classList.remove('hidden');
    els.wasteWrap.classList.add('hidden');
    els.twoManWrap.classList.add('hidden');
    els.stairsWrap.classList.add('hidden');
    els.descWrap.classList.add('hidden');
    els.routeHint.textContent = "Route: Home → Shop → Drop-off → Home";
  } else if (jt === "business" || jt === "other"){
    // Business/Other: addresses + description, no stairs/two-man/waste
    els.addrDropWrap.classList.remove('hidden');
    els.wasteWrap.classList.add('hidden');
    els.twoManWrap.classList.add('hidden');
    els.stairsWrap.classList.add('hidden');
    els.descWrap.classList.remove('hidden');
    els.routeHint.textContent = "Enter both addresses and a short description, then tap Calculate Quote.";
  }

  onWasteTypeChanged();
}

function calcDisposal(){
  const t = els.wasteType.value;
  if (t === "mattress" || t === "tyre"){
    const each = t==="mattress" ? RATES.disposal.mattress.each : RATES.disposal.tyre.each;
    const qty = Math.max(1, parseInt(els.itemQty.value)||1);
    return { fee: qty*each, detail: `${t} x ${qty} @ £${each.toFixed(2)}` };
  }
  const { minFee, ratePerTonne } = RATES.disposal[t];
  return { fee: minFee, detail: `Minimum disposal for ${t} (rate £${ratePerTonne}/t)` };
}

function calculate(){
  const miles = parseFloat(els.mileage.value)||0;
  const trips = 1;
  const jt = els.jobType.value;

  const twoManFee = (jt==="tip" || jt==="other" || jt==="business" || jt==="shop") ? 0 : (els.twoMan.value==="yes" ? RATES.twoMan : 0);
  const stairsCost = (jt==="tip" || jt==="other" || jt==="business" || jt==="shop") ? 0 :
    ((parseInt(els.stairsPickup.value)||0) + (parseInt(els.stairsDrop.value)||0)) * RATES.stairsPerFloor;
  const mileageCost = miles * RATES.mileagePerMile * trips;
  const disp = (jt==="tip") ? calcDisposal() : { fee: 0, detail: "N/A" };

  const total = RATES.baseFee + mileageCost + stairsCost + twoManFee + disp.fee;

  const lines = [
    `Base: £${RATES.baseFee.toFixed(2)}`,
    `Mileage: £${mileageCost.toFixed(2)}`
  ];
  if (stairsCost) lines.push(`Stairs: £${stairsCost.toFixed(2)}`);
  if (twoManFee) lines.push(`Two-person: £${twoManFee.toFixed(2)}`);
  if (jt==="tip") lines.push(`Disposal: £${disp.fee.toFixed(2)} — ${disp.detail}`);

  els.breakdown.innerHTML = '• ' + lines.join('<br>• ');
  els.total.textContent = `Total: £${total.toFixed(2)}`;
  return { total: total.toFixed(2) };
}

function getRouteStops(){
  const jt = els.jobType.value;
  if(jt==="tip") return { origin: HOME_ADDR, waypoints: [pickupAddress, WATERBEACH_ADDR], destination: HOME_ADDR };
  // For all other types we do Home → Pickup → Drop → Home
  return { origin: HOME_ADDR, waypoints: [pickupAddress, dropAddress], destination: HOME_ADDR };
}

function calcMileage(){
  const jt = els.jobType.value;
  if(!pickupAddress){ els.routeHint.textContent = "Enter collection address."; return; }
  if(jt!=="tip" && !dropAddress){ els.routeHint.textContent = "Enter delivery address."; return; }
  const { origin, waypoints, destination } = getRouteStops();
  directions.route(
    { origin, destination, waypoints: waypoints.filter(Boolean).map(a=>({location:a, stopover:true})), travelMode:'DRIVING' },
    (res, status)=>{
      if(status!=="OK"){ els.routeHint.textContent = "Route error"; return; }
      const miles = res.routes[0].legs.reduce((sum,l)=> su
